<?xml version="1.0"?>

<f:view
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:aui="http://liferay.com/faces/aui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:components="http://java.sun.com/jsf/composite/components">

	<h:head />

	<h:body>
		<h:messages showDetail="true" showSummary="true" />

		<p:tabView id="tabView">  
			<p:tab id="tab1" title="Creation">
				<aui:layout>
					<aui:column>
						<components:currentTaskSessionComponent
							currentTaskSession="#{taskSessionSimpleBean.currentTaskSession}"
							rendered="#{taskSessionSimpleBean.currentTaskSession!=null}"
							todayWithoutTime="#{taskSessionSimpleBean.todayWithoutTime}" />
					</aui:column>

					<aui:column>
						<components:endTaskComponent
							actionMethod="#{taskSessionSimpleBean.finishTaskSessionAction}"
							endTime="#{taskSessionSimpleBean.endTime}"
							rendered="#{taskSessionSimpleBean.currentTaskSession!=null}" />
					</aui:column>
				</aui:layout>

				<h:form id="taskForm">
					<aui:layout>
						<aui:column id="project_column_1">
							<h:selectOneListbox converter="DepartmentConverter" id="departmentList" style="height:200px"
								value="#{enabledProjectBean.selectedDepartment}" var="d">

								<f:selectItems itemLabel="#{department.departmentName}" itemValue="#{department}"
									value="#{taskBean.departmentBean.departments}" var="department" />

								<p:ajax event="change" listener="#{enabledProjectBean.onDepartmentSelect}"
									update=":#{p:component('project_column_2')}" />
							</h:selectOneListbox>
						</aui:column>

						<aui:column id="project_column_2">
							<components:taskComponent
								actionMethod="#{taskBean.createTaskAction}"
								projectRoot="#{enabledProjectBean.root}"
								selectedProjectNode="#{enabledProjectBean.selectedProjectNode}"
								startTime="#{taskSessionSimpleBean.startTime}"
								taskName="#{taskBean.taskName}" />
						</aui:column>
					</aui:layout>
				</h:form>

				<h:form id="taskSessionForm">
					<ui:repeat value="#{taskBean.tasksByUser}" var="task">
						<components:taskComponent
							actionMethod="#{taskSessionMultipleBean.createTaskSessionAction}"
							selectedTask="#{task}"
							startTime="#{taskSessionMultipleBean.startTimes[task.taskId]}" />
					</ui:repeat>
				</h:form>
			</p:tab>

			<p:tab id="tab2" title="Daily View">
				<components:taskSessionList taskBean="#{taskBean}" />
			</p:tab> 
		</p:tabView>
	</h:body>
</f:view>